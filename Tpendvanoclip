local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

local player = Players.LocalPlayer
local teleportEvent = ReplicatedStorage:WaitForChild("TeleportRequest")

local noclip = false
local npcLock = false
local guiVisible = true
local npc = workspace:FindFirstChild("TargetNPC")

-- T·∫°o GUI
local gui = Instance.new("ScreenGui")
gui.Name = "MobileGUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Khung ƒëi·ªÅu khi·ªÉn
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 180, 0, 220)
frame.Position = UDim2.new(0, 10, 0.5, -110)
frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
frame.Visible = guiVisible
frame.Parent = gui

-- H√†m t·∫°o n√∫t
local function createButton(text, yOffset, callback)
	local button = Instance.new("TextButton")
	button.Size = UDim2.new(1, -20, 0, 40)
	button.Position = UDim2.new(0, 10, 0, yOffset)
	button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	button.TextColor3 = Color3.fromRGB(255, 255, 255)
	button.Font = Enum.Font.SourceSansBold
	button.TextSize = 20
	button.Text = text
	button.Parent = frame
	button.MouseButton1Click:Connect(callback)
end

-- T·∫°o c√°c n√∫t ch√≠nh
createButton("üìç Teleport to End", 10, function()
	teleportEvent:FireServer()
end)

createButton("üåÄ Toggle NoClip", 60, function()
	noclip = not noclip
end)

createButton("üéØ Lock on NPC", 110, function()
	npcLock = not npcLock
	if not npcLock then
		local humanoid = player.Character and player.Character:FindFirstChild("Humanoid")
		if humanoid then Camera.CameraSubject = humanoid end
	end
end)

-- N√∫t Toggle Menu
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 140, 0, 40)
toggleBtn.Position = UDim2.new(0, 10, 1, -50)
toggleBtn.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
toggleBtn.TextColor3 = Color3.new(1,1,1)
toggleBtn.Text = "üîß Show/Hide Menu"
toggleBtn.Font = Enum.Font.SourceSansBold
toggleBtn.TextSize = 18
toggleBtn.Parent = gui

toggleBtn.MouseButton1Click:Connect(function()
	guiVisible = not guiVisible
	frame.Visible = guiVisible
end)

-- Noclip + NPC Lock loop
RunService.Stepped:Connect(function()
	if noclip and player.Character then
		for _, part in ipairs(player.Character:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end

	if npcLock and npc and npc:FindFirstChild("Humanoid") then
		Camera.CameraSubject = npc.Humanoid
	end
end)
